// Add these models to the end of schema.prisma before the last closing brace

model OrderItem {
  id                Int           @id @default(autoincrement())
  orderId           String        @map("order_id") @db.Uuid
  order             Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  itemNumber        Int           @map("item_number") // Position in order
  itemType          String        @default("blind") @map("item_type") @db.VarChar(50)
  
  // Common fields for all item types
  location          String        @db.VarChar(255)
  width             Int           // mm
  drop              Int           // mm
  
  // Blind-specific fields (16 total from HTML prototype)
  fixing            String?       @db.VarChar(100)
  bracketType       String?       @map("bracket_type") @db.VarChar(100)
  bracketColour     String?       @map("bracket_colour") @db.VarChar(100)
  controlSide       String?       @map("control_side") @db.VarChar(20) // "Left" | "Right"
  chainOrMotor      String?       @map("chain_or_motor") @db.VarChar(255)
  roll              String?       @db.VarChar(20) // "Front" | "Back"
  material          String?       @db.VarChar(100) // Brand: Gracetech, Textstyle, Uniline, Vertex, Alpha
  fabricType        String?       @map("fabric_type") @db.VarChar(255)
  fabricColour      String?       @map("fabric_colour") @db.VarChar(100)
  bottomRailType    String?       @map("bottom_rail_type") @db.VarChar(100)
  bottomRailColour  String?       @map("bottom_rail_colour") @db.VarChar(100)
  
  // Calculated fields
  calculatedWidth   Int?          @map("calculated_width") // width - 28
  calculatedDrop    Int?          @map("calculated_drop")  // drop + 150
  isDuplicate       Boolean       @default(false) @map("is_duplicate")
  
  // Pricing
  fabricGroup       Int?          @map("fabric_group") // 1-5
  discountPercent   Decimal       @default(0) @map("discount_percent") @db.Decimal(5, 2)
  price             Decimal       @default(0) @db.Decimal(10, 2)
  
  createdAt         DateTime      @default(now()) @map("created_at") @db.Timestamp(6)
  
  @@map("order_items")
  @@index([orderId])
  @@index([material, fabricType])
}

model PricingMatrix {
  id          Int      @id @default(autoincrement())
  fabricGroup Int      @map("fabric_group") // 1-5
  width       Int      // mm (600-3000)
  drop        Int      // mm (1200-3000)
  price       Decimal  @db.Decimal(10, 2)
  
  updatedBy   String?  @map("updated_by") @db.VarChar(255)
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamp(6)
  
  @@unique([fabricGroup, width, drop])
  @@map("pricing_matrix")
  @@index([fabricGroup])
}

model Quote {
  id               String      @id @default(uuid()) @db.Uuid
  quoteNumber      String      @unique @map("quote_number") @db.VarChar(50) // QT-YYMMDD-XXXX
  userId           String      @map("user_id") @db.Uuid
  user             User        @relation("UserQuotes", fields: [userId], references: [id], onDelete: Cascade)
  
  productType      ProductType @map("product_type")
  items            Json        // Store items as JSON
  subtotal         Decimal     @db.Decimal(10, 2)
  total            Decimal     @db.Decimal(10, 2)
  notes            String?     @db.Text
  
  convertedToOrder String?     @map("converted_to_order") @db.Uuid // Order ID if converted
  
  createdAt        DateTime    @default(now()) @map("created_at") @db.Timestamp(6)
  expiresAt        DateTime    @map("expires_at") @db.Timestamp(6) // +30 days
  
  @@map("quotes")
  @@index([userId])
  @@index([quoteNumber])
}
